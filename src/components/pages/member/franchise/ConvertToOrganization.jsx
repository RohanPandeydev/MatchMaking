import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useFormik } from "formik";
import { values } from "lodash";
import React from "react";
import { useEffect } from "react";
import { IoArrowForwardSharp, IoClose } from "react-icons/io5";
import {
  Button,
  Col,
  Collapse,
  FormGroup,
  Input,
  InputGroup,
  InputGroupText,
  Label,
  Modal,
  ModalBody,
  Row,
} from "reactstrap";
import MemberServices from "../../../../services/MemberServices";
import Swal from "sweetalert2";
import ButtonLoader from "../../../../utils/Loader/ButtonLoader";
import { VerifyOrganizationConversionForm } from "../../../../helper/ValidationHelper/Validation";
import ConvertFranchiseImg from "../../../../assets/images/convert-franchise.svg";
import { LiaExchangeAltSolid } from "react-icons/lia";
const ConvertToOrganization = ({
  toggleModel,
  handleToggleModel,
  setToggleModel,
  setModelData,
  modelData,
  pageNumber,
}) => {
  const handleCloseModel = () => {
    handleReset();
    setToggleModel(false);
  };
  const queryClient = useQueryClient();
  const initialValues = {
    host: "",
    account_type: "org",
    id: "",
  };

  const formik = useFormik({
    initialValues: initialValues,
    validationSchema: VerifyOrganizationConversionForm,
    onSubmit: (values, action) => {
      submitHandler(values);
    },
  });

  const submitHandler = (data) => {
    console.log(data);
    if (!data?.id) {
      Swal.fire({
        title: "Error",
        text: "Please try again later",
        icon: "error",
      });
      return;
    }
    memberOrganizationUpdate.mutate(data);
  };

  const handleReset = () => {
    queryClient.refetchQueries(["member-franchise", pageNumber]);
    setModelData({});
  };

  useEffect(() => {
    if (modelData && Object.keys(modelData)?.length > 0) {
      formik.setFieldValue(
        "host",
        modelData?.name.toLowerCase()?.replace(/\s+/g, "") || ""
      );
      formik.setFieldValue("id", modelData?.id || "");
    }
  }, [modelData && Object.keys(modelData)?.length]);

  const memberOrganizationUpdate = useMutation(
    (data) => MemberServices.ConversionFranchiseToOrganization(data),
    {
      onSuccess: (data) => {
        // console.log("Data after submission organization", data?.data);
        // formik.resetForm();
        // alert("Created Successfully")
        Swal.fire({
          title: "Successfull",
          text: "Account has been converted to organization successfully",
          icon: "success",
        });
        handleCloseModel();

        // setShowForm(false);
        // queryClient.invalidateQueries("subscription-organization");
      },
      onError: (err) => {
        console.log("Error response data:", err.message);

        // Check for specific error messages or provide a generic message
        const msg =
          err.response?.data?.username?.[0] ||
          err.response?.data?.host?.[0] ||
          "An unexpected error occurred. Please try again.";

        Swal.fire({
          title: "Error",
          text: msg,
          icon: "error",
        });

        return;
      },
    }
  );

  return (
    <Modal
      size="lg"
      centered={true}
      className="common-modal"
      isOpen={toggleModel}
      toggle={handleToggleModel}
    >
      <form onSubmit={formik.handleSubmit}>
        <Button className="close-btn" onClick={handleCloseModel}>
          <IoClose />
        </Button>

        <ModalBody>
          <div className="convert-to-org-franchise-wrapper mt-4">
            <div className="org-fra-img">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                enable-background="new 0 0 100 100"
                strokeWidth="0"
                stroke="currentColor"
                fill="currentColor"
                width="1em"
                height="1em"
                viewBox="0 0 100 100"
              >
                <path
                  d="M85.783,64.676c0.779-1.321,1.236-2.898,1.236-4.593c0-4.633-3.387-8.403-7.55-8.403c-4.163,0-7.551,3.77-7.551,8.403
	c0,2.471,0.97,4.689,2.5,6.228c-0.652,0.682-1.196,1.46-1.608,2.313l-6.159,6.381h-8.225c-2.817,0-5.109,2.308-5.109,5.144
	c0,0.627,0.118,1.225,0.323,1.781h-7.28c0.205-0.556,0.322-1.154,0.322-1.781c0-2.836-2.292-5.144-5.109-5.144h-8.225l-6.158-6.381
	c-0.413-0.853-0.956-1.631-1.609-2.313c1.531-1.539,2.501-3.757,2.501-6.228c0-4.633-3.387-8.403-7.551-8.403
	c-4.163,0-7.55,3.77-7.55,8.403c0,1.695,0.457,3.271,1.236,4.593c-2.742,1.565-4.594,4.463-4.594,7.782v16.194
	c0,0.928,0.752,1.681,1.68,1.681c0.928,0,1.681-0.752,1.681-1.681V72.458c0-2.348,1.493-4.364,3.612-5.218
	c0.695-0.279,1.456-0.435,2.254-0.435c1.443,0,2.763,0.507,3.786,1.342c0.142,0.116,0.278,0.238,0.409,0.366
	c0.007,0.411,0.158,0.821,0.466,1.14l0.526,0.545l0.322,0.333l2.039,2.113l1.681,1.741l3.346,3.467
	c0.317,0.328,0.753,0.514,1.21,0.514h8.939c0.964,0,1.748,0.8,1.748,1.783c0,0.982-0.784,1.781-1.748,1.781h-8.379h-1.98
	c-0.656,0-1.087-0.377-1.287-0.602c-0.045-0.051-0.094-0.1-0.145-0.145c-0.037-0.034-0.07-0.062-1.703-1.305
	c-0.436-0.332-0.987-0.75-1.681-1.278c-0.486-0.37-1.042-0.792-1.68-1.277c-0.682-0.518-1.454-1.105-2.335-1.773l-1.016,1.338
	l-1.017,1.339c0,0,2.351,1.785,4.368,3.317v7.108c0,0.928,0.752,1.681,1.68,1.681c0.928,0,1.681-0.752,1.681-1.681V84.18
	c0.895,0.711,1.997,1.112,3.136,1.112h0.299v3.361c0,0.928,0.752,1.681,1.681,1.681c0.928,0,1.68-0.752,1.68-1.681v-3.361h6.699
	h16.853h6.631v3.361c0,0.928,0.752,1.681,1.681,1.681c0.928,0,1.68-0.752,1.68-1.681v-3.361h0.367c1.139,0,2.24-0.4,3.136-1.111
	v4.472c0,0.928,0.752,1.681,1.68,1.681c0.928,0,1.681-0.752,1.681-1.681v-7.107c2.028-1.542,4.368-3.318,4.368-3.318
	c0.738-0.562,0.883-1.616,0.322-2.355c-0.468-0.614-1.274-0.811-1.959-0.538c-0.138,0.055-0.272,0.122-0.396,0.216
	c-0.881,0.668-1.653,1.255-2.335,1.773c-0.638,0.485-1.194,0.908-1.681,1.277c-0.694,0.528-1.245,0.946-1.68,1.278
	c-1.633,1.243-1.666,1.272-1.703,1.305c-0.052,0.045-0.1,0.094-0.146,0.145c-0.199,0.225-0.631,0.602-1.286,0.602h-2.047h-8.312
	c-0.963,0-1.748-0.799-1.748-1.781c0-0.983,0.785-1.783,1.748-1.783h8.939c0.457,0,0.893-0.185,1.21-0.514l3.346-3.467l1.68-1.741
	l2.039-2.113l0.322-0.333l0.526-0.545c0.308-0.319,0.46-0.728,0.466-1.14c0.13-0.128,0.266-0.25,0.409-0.366
	c1.023-0.835,2.343-1.342,3.786-1.342c0.798,0,1.559,0.156,2.254,0.435c2.119,0.854,3.612,2.87,3.612,5.218v16.194
	c0,0.928,0.752,1.681,1.68,1.681c0.928,0,1.681-0.752,1.681-1.681V72.458C90.377,69.139,88.526,66.241,85.783,64.676z
	 M81.149,63.444c-1.412,0-2.745,0.32-3.942,0.876c-1.158-0.898-1.928-2.46-1.928-4.237c0-2.78,1.88-5.042,4.19-5.042
	c2.31,0,4.189,2.262,4.189,5.042c0,1.344-0.442,2.564-1.157,3.469C82.059,63.488,81.609,63.444,81.149,63.444z M16.342,60.083
	c0-2.78,1.879-5.042,4.189-5.042s4.19,2.262,4.19,5.042c0,1.777-0.771,3.339-1.928,4.237c-1.197-0.556-2.531-0.876-3.942-0.876
	c-0.46,0-0.909,0.044-1.351,0.108C16.784,62.647,16.342,61.428,16.342,60.083z M29.833,28.771v16.187c0,0.928,0.752,1.68,1.68,1.68
	h15.125h6.722h15.125c0.928,0,1.681-0.752,1.681-1.68V28.771c1.521-1.064,2.521-2.827,2.521-4.82v-2.521
	c0-0.028-0.007-0.052-0.008-0.079c-0.002-0.047-0.008-0.094-0.014-0.14c-0.01-0.08-0.026-0.159-0.048-0.238
	c-0.007-0.025-0.007-0.05-0.015-0.075L69.24,10.816c-0.229-0.686-0.871-1.149-1.595-1.149h-6.723h-6.722h-8.403h-6.722h-6.722
	c-0.724,0-1.366,0.463-1.594,1.149l-3.361,10.083c-0.008,0.025-0.008,0.051-0.015,0.075c-0.022,0.078-0.038,0.157-0.048,0.236
	c-0.007,0.047-0.012,0.094-0.014,0.141c-0.001,0.027-0.008,0.052-0.008,0.079v2.521C27.312,25.944,28.312,27.707,29.833,28.771z
	 M37.092,13.028l-1.12,6.722h-4.648l2.241-6.722H37.092z M66.435,13.028l2.241,6.722h-4.647l-1.12-6.722H66.435z M66.805,43.278
	H55.042v-8.403c0-0.928-0.752-1.68-1.681-1.68h-6.722c-0.928,0-1.68,0.752-1.68,1.68v8.403H33.194V29.833
	c1.645,0,3.133-0.681,4.201-1.774c1.069,1.092,2.556,1.774,4.201,1.774c1.645,0,3.133-0.681,4.201-1.774
	c1.069,1.092,2.556,1.774,4.201,1.774c1.645,0,3.133-0.681,4.201-1.774c1.069,1.092,2.556,1.774,4.201,1.774
	c1.645,0,3.133-0.681,4.201-1.774c1.069,1.092,2.556,1.774,4.201,1.774V43.278z M51.681,43.278h-3.361v-6.722h3.361V43.278z
	 M44.118,23.111v0.84c0,0.296-0.061,0.576-0.155,0.84c-0.348,0.976-1.272,1.681-2.365,1.681c-1.095,0-2.019-0.705-2.366-1.681
	c-0.095-0.264-0.155-0.544-0.155-0.84v-0.84H44.118z M60.923,23.951c0,0.296-0.061,0.576-0.155,0.84
	c-0.348,0.976-1.272,1.681-2.366,1.681c-1.094,0-2.018-0.705-2.366-1.681c-0.094-0.264-0.154-0.544-0.154-0.84v-0.84h5.041V23.951z
	 M52.521,23.951c0,0.296-0.061,0.576-0.155,0.84c-0.348,0.976-1.272,1.681-2.366,1.681c-1.094,0-2.018-0.705-2.366-1.681
	c-0.094-0.264-0.154-0.544-0.154-0.84v-0.84h5.042V23.951z M35.715,23.951c0,0.296-0.061,0.576-0.154,0.84
	c-0.348,0.976-1.272,1.681-2.366,1.681c-0.648,0-1.234-0.253-1.681-0.656c-0.512-0.462-0.84-1.123-0.84-1.866v-0.607v-0.233h0.84
	h4.201V23.951z M69.326,23.344v0.607c0,0.743-0.328,1.404-0.84,1.866c-0.447,0.403-1.032,0.656-1.68,0.656
	c-1.094,0-2.018-0.705-2.366-1.681c-0.094-0.264-0.155-0.544-0.155-0.84v-0.84h4.201h0.84V23.344z M59.5,13.028l1.12,6.722h-4.738
	v-6.722H59.5z M52.521,19.75h-5.042v-6.722h5.042V19.75z M44.118,19.75H39.38l1.12-6.722h3.618V19.75z M39.917,34.875v1.681
	c0,0.928-0.752,1.681-1.681,1.681c-0.928,0-1.68-0.753-1.68-1.681v-1.681c0-0.928,0.752-1.68,1.68-1.68
	C39.164,33.194,39.917,33.947,39.917,34.875z M61.764,33.194c0.928,0,1.681,0.752,1.681,1.68v1.681c0,0.928-0.752,1.681-1.681,1.681
	c-0.928,0-1.68-0.753-1.68-1.681v-1.681C60.083,33.947,60.836,33.194,61.764,33.194z M38.236,61.764
	c0-2.468,0.777-4.832,2.164-6.793c-0.195-0.226-0.334-0.505-0.387-0.823c-0.153-0.915,0.466-1.78,1.382-1.933l2.631-0.438
	c0.069-0.013,0.137-0.005,0.205-0.009c0.031-0.002,0.061-0.004,0.091-0.004c0.09,0.001,0.179,0.008,0.267,0.024
	c0.028,0.005,0.054,0.012,0.081,0.018c0.14,0.031,0.274,0.083,0.402,0.149c0.048,0.025,0.099,0.045,0.145,0.075
	c0.046,0.029,0.086,0.067,0.129,0.101c0.062,0.05,0.123,0.102,0.178,0.162c0.017,0.018,0.039,0.03,0.055,0.049
	c0.018,0.021,0.027,0.046,0.044,0.068c0.022,0.028,0.048,0.051,0.068,0.081c0.032,0.047,0.054,0.099,0.081,0.149
	c0.018,0.033,0.039,0.065,0.055,0.1c0.116,0.251,0.164,0.519,0.151,0.784c-0.001,0.013-0.003,0.025-0.004,0.038
	c-0.01,0.135-0.034,0.269-0.078,0.4c-0.001,0.001-0.001,0.003-0.001,0.004l-0.002,0.008l-0.036,0.108l-0.838,2.515
	c-0.235,0.705-0.89,1.15-1.594,1.15c-0.176,0-0.355-0.028-0.532-0.087c-0.062-0.021-0.117-0.052-0.175-0.079
	c-0.722,1.256-1.12,2.692-1.12,4.183c0,4.633,3.77,8.403,8.402,8.403c0.928,0,1.681,0.752,1.681,1.681
	c0,0.928-0.752,1.68-1.681,1.68C43.513,73.528,38.236,68.25,38.236,61.764z M61.764,61.764c0,2.469-0.777,4.834-2.165,6.795
	c0.195,0.226,0.335,0.505,0.388,0.821c0.153,0.915-0.466,1.781-1.382,1.933l-2.631,0.438c-0.092,0.015-0.184,0.023-0.276,0.023
	c-0.267,0-0.526-0.069-0.761-0.189c-0.019-0.009-0.036-0.022-0.054-0.032c-0.091-0.05-0.178-0.109-0.259-0.176
	c-0.032-0.027-0.062-0.057-0.092-0.087c-0.037-0.036-0.079-0.065-0.112-0.105c-0.021-0.025-0.032-0.054-0.051-0.079
	c-0.019-0.025-0.044-0.044-0.062-0.069c-0.034-0.05-0.057-0.104-0.085-0.156c-0.016-0.03-0.034-0.058-0.048-0.089
	c-0.057-0.124-0.099-0.254-0.124-0.388c-0.026-0.134-0.035-0.27-0.028-0.406c0-0.008,0.002-0.016,0.002-0.024
	c0.009-0.134,0.037-0.265,0.076-0.392c0.002-0.007,0.002-0.014,0.004-0.02l0.041-0.121l0.837-2.51
	c0.294-0.879,1.244-1.359,2.126-1.063c0.062,0.021,0.117,0.052,0.175,0.079c0.722-1.256,1.12-2.693,1.12-4.183
	c0-4.633-3.77-8.402-8.403-8.402c-0.928,0-1.68-0.753-1.68-1.681C48.319,50.753,49.072,50,50,50
	C56.486,50,61.764,55.277,61.764,61.764z"
                />
              </svg>
              <h4>Franchise</h4>
            </div>
            <div className="convert-animation">
              <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>
            </div>

            <div className="org-fra-img">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                strokeWidth="0"
                stroke="currentColor"
                fill="currentColor"
                width="1em"
                height="1em"
                viewBox="0 0 128 128"
              >
                <path d="M.01 117.524v5.238c0 2.893-.417 5.238 4 5.238h31.996c4.418 0 3.986-2.346 3.98-5.239l-.01-5.237c0-7.263-5.939-12.975-13.054-14.859 2.775-2.1 4.578-5.418 4.578-9.164 0-6.35-5.154-11.502-11.5-11.502-6.348 0-11.5 5.151-11.5 11.502 0 3.744 1.8 7.062 4.574 9.161-7.119 1.88-13.063 7.594-13.063 14.862zM12.5 93.5c0-4.137 3.364-7.502 7.5-7.502s7.5 3.365 7.5 7.502c0 4.134-3.364 7.498-7.5 7.498s-7.5-3.364-7.5-7.498zm5.603 12.5h3.774c6.669 0 14.1 4.733 14.1 11.53l.01 5.24c0 .255.003.507.007.753L36 124H4.001c0-.171.002-.343.004-.498.003-.242.006-.49.006-.74v-5.238c0-6.791 7.426-11.524 14.092-11.524zM127.986 122.761l-.01-5.237c0-7.263-5.939-12.975-13.054-14.859 2.775-2.1 4.578-5.418 4.578-9.164 0-6.35-5.154-11.502-11.5-11.502-6.348 0-11.5 5.151-11.5 11.502 0 3.744 1.8 7.062 4.574 9.161-7.119 1.88-13.063 7.594-13.063 14.862v5.238c0 2.893-.418 5.238 3.999 5.238h31.996c4.418 0 3.986-2.346 3.98-5.239zM100.5 93.501c0-4.137 3.364-7.502 7.5-7.502s7.5 3.365 7.5 7.502c0 4.134-3.364 7.498-7.5 7.498s-7.5-3.364-7.5-7.498zM92.01 124H92c0-.171.002-.343.004-.498.003-.242.006-.49.006-.74v-5.238c0-6.791 7.426-11.524 14.092-11.524h3.774c6.669 0 14.1 4.733 14.1 11.53l.01 5.24c0 .255.003.507.007.753L124 124H92.01zM44.01 117.524v5.238c0 2.893-.417 5.238 4 5.238h31.996c4.418 0 3.986-2.346 3.98-5.239l-.01-5.237c0-7.263-5.939-12.975-13.054-14.859 2.775-2.1 4.578-5.418 4.578-9.164 0-6.35-5.154-11.502-11.5-11.502-6.348 0-11.5 5.151-11.5 11.502 0 3.744 1.8 7.062 4.574 9.161-7.119 1.88-13.063 7.594-13.063 14.862zM56.5 93.5c0-4.137 3.364-7.502 7.5-7.502s7.5 3.365 7.5 7.502c0 4.134-3.364 7.498-7.5 7.498s-7.5-3.364-7.5-7.498zm5.603 12.5h3.774c6.669 0 14.1 4.733 14.1 11.53l.01 5.24c0 .255.003.507.007.753L80 124H48.001c0-.171.002-.343.004-.498.003-.242.006-.49.006-.74v-5.238c0-6.791 7.426-11.524 14.092-11.524zM36.26 42.885c-8.541 6.107-14.986 14.991-17.917 25.48l-.494-1.196a2 2 0 0 0-3.698 1.527l3.332 8.068a2 2 0 0 0 3.425.467l5.387-6.892a2 2 0 0 0-3.152-2.462l-.812 1.038c2.43-8.28 7.275-15.434 13.669-20.772v8.954C36 58.7 37.794 60 40.007 60H62v7.946l-.232-.439a2 2 0 1 0-3.535 1.871l4 7.558a2 2 0 0 0 3.535 0l4-7.558a2 2 0 1 0-3.536-1.87l-.232.438V60h21.996c2.213 0 4.007-1.3 4.004-2.903-.002-1.158-.005-6.035-.006-8.923 6.36 5.321 11.186 12.437 13.618 20.669l-.755-.966a2 2 0 0 0-3.152 2.462l5.387 6.892a2.002 2.002 0 0 0 3.425-.467l3.332-8.068a2 2 0 0 0-3.698-1.527l-.515 1.247c-2.92-10.49-9.36-19.382-17.898-25.499-1.177-7.064-6.314-12.814-12.92-16.052a19.146 19.146 0 0 1-3.072 3.041c6.754 2.85 12.247 8.688 12.247 16.1 0 0 .003 6.982.006 9.994H82v-6a2 2 0 0 0-4 0v6H50v-6a2 2 0 0 0-4 0v6h-6v-9.996c0-7.414 5.495-13.254 12.25-16.102a19.122 19.122 0 0 1-3.07-3.042c-6.598 3.232-11.733 8.973-12.92 16.025z" />
                <path d="M79 15.003C79 6.719 72.276 0 64.001 0 55.72 0 49 6.719 49 15.003c0 6.867 4.63 12.648 10.934 14.423L57.105 42.14c-.32 1.194.124 3.45 1.52 4.465l2.964 2.615.28.207c.622.381 1.387.572 2.15.572.764 0 1.528-.19 2.152-.572l3.252-2.828c1.29-.955 1.84-3.132 1.45-4.473L67.589 29.55C74.132 27.937 79 22.042 79 15.003zm-12.094 28.48-2.853 2.518-.06.006-2.874-2.537a1.644 1.644 0 0 1-.117-.435l2.749-12.35 3.247 12.433c-.01.105-.05.262-.092.366zM64.001 26C57.935 26 53 21.067 53 15.003 53 8.936 57.935 4 64.001 4 70.065 4 75 8.936 75 15.003 75 21.067 70.065 26 64.001 26z" />
              </svg>
              <h4>Organization</h4>
            </div>
          </div>
          <Row className="mt-2">
            <Col xs="12" md="12" lg="12">
              <FormGroup className="common-formgroup">
                <Label> Sub Domain Name </Label>
                <Input
                  id=""
                  name="host"
                  value={formik.values.host}
                  onBlur={formik.handleBlur}
                  onChange={formik.handleChange}
                  placeholder="|"
                  type="text"
                  className={
                    formik.touched.host && formik.errors.host
                      ? "is-invalid"
                      : ""
                  }
                />{" "}
              </FormGroup>
              {formik.touched.host && (
                <p className="text-danger">{formik.errors.host}</p>
              )}
            </Col>
            <Col xs="12" md="12" lg="12" className="text-center">
              <Button
                className="btn btn-style1 px-4"
                type="submit"
                disabled={memberOrganizationUpdate?.isLoading}
              >
                {memberOrganizationUpdate?.isLoading ? (
                  <ButtonLoader />
                ) : (
                  <>
                    Franchise <IoArrowForwardSharp /> Organization
                  </>
                )}
              </Button>
            </Col>
          </Row>
        </ModalBody>
      </form>
    </Modal>
  );
};

export default ConvertToOrganization;
